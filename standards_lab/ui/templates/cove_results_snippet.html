{% extends 'explore.html' %}
{% load i18n %}
{% load cove_tags %}


{% block header_button %}
  <div class="row">
    <a href="{% url 'index' %}" class="btn btn-large btn-success">{% trans 'Load New File' %}</a>
  </div>
{% endblock %}

{% block explore_content %}

<div class="container mt-2">
    <div class="row">

        {% if validation_errors %}
              {% for error_json, values in validation_errors %}
                {% with error=error_json|json_decode %}
                  {% cove_modal_errors className="validation-errors-"|concat:forloop.counter modalTitle=error.message errorList=values file_type=file_type full_table=True %}
                {% endwith %}
              {% endfor %}


              <a name="validation-errors" class="anchor"></a>
              <div class="panel panel-danger">
                <div id="validation-panel" class="panel-heading pointer" role="region" aria-expanded="true" >
                  <h4 class="panel-title">
                    {% trans 'Structural Errors' %}
                  </h4>
                </div>
                <div id="validationTable" class="panel-body">
                  {% include "validation_table.html" %}
                </div>
              </div>
        {% else %}
             <div class="panel panel-success">
                <div id="validation-panel" class="panel-heading pointer" role="region">
                  <h4 class="panel-title">
                    {% trans 'Structural Errors' %}
                  </h4>
                </div>
                <div id="validationTable" class="panel-body">
                    <p>{% trans 'There were no structural errors' %}.</p>
                </div>
              </div>
        {% endif %}

    </div>

    <div class="row">

        {% if additional_fields_count %}

              <a name="additional-fields" class="anchor"></a>
              <div class="panel panel-danger">
                <div id="validation-panel" class="panel-heading pointer" role="region" aria-expanded="true" aria-controls="validationTable">
                  <h4 class="panel-title">
                    <span class="glyphicon glyphicon-collapse-up"></span>{% trans 'Additional Fields' %}
                  </h4>
                </div>
                <div id="additionalFieldsTable" class="panel-body">
                  {% include "additional_fields_table_all.html" %}
                </div>
              </div>
        {% else %}
             <div class="panel panel-success">
                <div id="validation-panel" class="panel-heading pointer" role="region" aria-expanded="true" aria-controls="validationTable" >
                  <h4 class="panel-title">
                    <span class="glyphicon glyphicon-collapse-up"></span>{% trans 'Additional Fields' %}
                  </h4>
                </div>
                <div id="additionalFieldsTable" class="collapse in panel-body">
                    <p>{% trans 'There were no additional fields' %}.</p>
                </div>
              </div>
        {% endif %}

    </div>

    {% if additional_open_codelist_values %}
    <div class="row">
      <a name="additional-open-codelist-values" class="anchor"></a>
      <div class="panel panel-warning">
        <div id="additional-open-codelist-values-panel" class="panel-heading pointer" role="region" aria-expanded="true"
          aria-controls="additionalOpenCodelist" data-toggle="collapse" data-target="#additionalOpenCodelist">
          <h4 class="panel-title">
            <span class="our-title"><span
                class="glyphicon glyphicon-collapse-up"></span>{% trans 'Additional Codelist Values' %}</span>
          </h4>
        </div>
        <div class="panel-body">
          {% trans 'Your data contains a number of fields that use an open codelist. You should use values from the codelist whenever possible, but if the codelist does not provide the values you need, you are permitted to add additional values. The values below do not appear in the codelist; you should check that you intended these as additional values.' %}
          <div id="additionalOpenCodelist" class="in">
            {% with additional_codelist_values=additional_open_codelist_values %}
            {% include "additional_codelist_values.html" %}
            {% endwith%}
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    {% if conformance_checks %}
     <div class="row">
     {% for check in conformance_checks %}
       <a name="conformance-rules" class="anchor"></a>
       <div class="panel panel-danger">
         <div id="conformance-rules-panel" class="panel-heading pointer" role="region" aria-expanded="true" aria-controls="conformanceRulesTable" data-toggle="collapse" data-target="#conformanceRulesTable">
           <h4 class="panel-title">
             <span class="our-title"><span class="glyphicon glyphicon-collapse-up"></span>{% trans 'Conformance (Rules)' %}</span>
           </h4>
         </div>
         <div id="conformanceRulesTable" class="collapse in">
           <div class="panel-body">
             <p class="explanation">{% trans 'Fixing the following issues will improve the interoperability of your data.' %}</p>
             <br>
             <p>
               {% blocktrans trimmed with count=check.path_values|length %}
               {{ count }} of your project <code>id</code> fields has a problem: There is no prefix or the prefix format is not recognised.
               {% endblocktrans %}
               <a class="view-all" role="region" aria-expanded="false" aria-controls="OC4IDSprefixesTable" data-toggle="collapse" data-target="#OC4IDSprefixesTable"><small>{% trans "View all errors" %} &#9660;</small></a>
             </p>

             <div id="OC4IDSprefixesTable" class="collapse">
               <table class="table table-striped">
                 <thead><tr><th>{% trans "id" %}</th><th>{% trans "Path" %}</th></tr></thead>
                 <tbody>
                   {% for result in check.path_values %}
                   <tr><td>{{result.value}}</td><td>{{result.path}}</td></tr>
                   {% endfor %}
                 </tbody>
               </table>
             </div>
           </div>
         </div>
       </div>

     {% endfor %}
     </div>
    {% endif %}

    {% if additional_checks %}
    <div class="row">

      <a name="additional_checks" class="anchor"></a>
      <div class="panel panel-warning">
        <div id="additional-checks-panel" class="panel-heading pointer" role="region" aria-expanded="true" aria-controls="additionalChecksTable" data-toggle="collapse" data-target="#additionalChecksTable">
          <h4 class="panel-title">
            <span class="glyphicon glyphicon-collapse-up"></span>{% trans 'Additional Checks' %}
          </h4>
        </div>
        <div id="additionalChecksTable" class="collapse in">
          {% include "cove_oc4ids/additional_checks_table.html" %}
        </div>
      </div>

    </div>
    {% endif %}

</div>
{% endblock explore_content %}


{% block bottomcontent1 %}
{% endblock %}
{% block bottomcontent2 %}
{% endblock %}